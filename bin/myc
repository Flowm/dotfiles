#!/usr/bin/env bash
set -eu

usage() {
	echo -e "Usage: $0 [-puib]" 1>&2
	echo -e "\t-p Print clone command" 1>&2
	echo -e "\t-u Update config" 1>&2
	echo -e "\t-i Install config" 1>&2
	echo -e "\t-b Install base packages" 1>&2
	exit 1
}

while getopts ":puibdh" opt; do
	case $opt in
		p)
			PRINT=true;
			;;
		u)
			UPDATE=true;
			;;
		i)
			INST=true;
			;;
		b)
			BASE=true;
			;;
		d)
			DEBUG=true; set -x
			;;
		*)
			usage
			;;
	esac
done
shift $(($OPTIND - 1))

conf_dir="$HOME/.myconf"
conf_bin="$conf_dir/bin"
conf_hist="$conf_dir/history"
conf_tools="$conf_dir/tools"

if [ ${PRINT:-} ]; then
	cat ${conf_dir}/data/instdb/myconf
fi

if [ ${UPDATE:-} ]; then
	cd ${conf_dir} && git pull --ff-only && git submodule update
fi

if [ ${INST:-} ]; then
	echo "Installing myconf"
	${conf_tools}/config-install.sh
fi

if [ ${BASE:-} ]; then
	echo "Installing base software"
	sudo ${conf_dir}/data/instdb/apt-base
fi
